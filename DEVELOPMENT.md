# Sound Aid 개발 문서

## 개발 환경 설정

### 필요한 소프트웨어

- Arduino IDE (버전 1.8.0 이상)
- C/C++ 컴파일러
- Git

### 라이브러리 의존성

```cpp
#include <SoftwareSerial.h>  // Arduino 기본 라이브러리
```

## 코드 구조

### 주요 함수들

#### `setup()`

- 시스템 초기화
- 핀 모드 설정
- 시리얼 통신 초기화

#### `loop()`

- 메인 실행 루프
- 각 기능별 핸들러 함수 호출

#### `handleVolumeControl()`

- 볼륨 업/다운 버튼 처리
- 볼륨 범위: 0-10
- 디바운스 처리 포함

#### `handleBusStopUpdate()`

- 정류장 자동 업데이트 (5초 간격)
- 하차 벨 상태 리셋

#### `handleStopoverButton()`

- 하차 버튼 처리
- LED 점등 및 부저 알림

#### `handleCurrentBusStop()`

- 현재 정류장 조회 버튼 처리
- 블루투스로 "400" 코드 전송

#### `SWKeyPad_NUM()`

- 키패드 매트릭스 스캔
- 키 입력 감지 및 고유 코드 반환
- LED 및 부저 피드백

#### `handleReservation()`

- 정류장 예약 시스템 처리
- 키패드 입력에 따른 예약/취소
- 목적지까지 거리 계산 및 알림

## 상태 변수

```cpp
int volume = 5;             // 현재 볼륨 (0-10)
int busstop = 0;            // 현재 버스 정류장 번호
bool stopoverFlag = false;  // 하차 벨 활성화 상태
int reservedStop = -1;      // 예약된 정류장 (-1: 예약없음)
int distanceToStop = 0;     // 예약 정류장까지 거리
```

## 통신 프로토콜

### 송신 데이터 (Arduino → 스마트폰)

| 값      | 의미                           |
| ------- | ------------------------------ |
| 0-10    | 볼륨 레벨                      |
| 300-304 | 현재 정류장 번호 (300+busstop) |
| 400     | 현재 정류장 정보 요청          |
| 201-212 | 키패드 입력값                  |
| 거리값  | 예약 정류장까지 남은 정거장 수 |

## 디버깅

### 시리얼 모니터 출력

```cpp
Serial.println("버튼" + String(keys[r][c]));
```

### 블루투스 통신 확인

- HC-06 모듈의 LED 상태 확인
- 페어링 상태: 빠른 깜빡임
- 연결 상태: 느린 깜빡임 또는 상시 점등

## 알려진 이슈

1. **키패드 응답성**: 빠른 연속 입력 시 일부 입력이 누락될 수 있음

   - 해결방안: 적절한 delay() 값 조정

2. **블루투스 연결 불안정**: 간헐적 연결 끊김 현상

   - 해결방안: 전원 공급 안정화, 안테나 거리 조정

3. **부저 소음**: 주변 환경에 따른 소음 문제
   - 해결방안: 볼륨 조절 기능으로 대응

## 향후 개선사항

1. **배터리 절약 모드**: 슬립 모드 구현
2. **GPS 연동**: 실제 위치 기반 정류장 정보
3. **다국어 지원**: 음성 안내 다국어 대응
4. **사용자 설정**: 개인별 설정 저장 기능
